---
resources:
- name: resource-tutorial
  type: git
  source:
    uri: https://github.com/abaker-9/concourse-tutorial.git
    branch: testing

jobs:
- name: job-pass-files
  public: true
  plan:
  - get: resource-tutorial
  - task: create-some-files
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}

      inputs:
      - name: resource-tutorial
      outputs:
      - name: some-files

      run:
        path: resource-tutorial/tutorials/basic/task-outputs-to-inputs/create_some_files.sh

  - task: create-some-cheese
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}

      inputs:
      - name: resource-tutorial
      outputs:
      - name: some-cheese

      run:
        path: resource-tutorial/tutorials/basic/task-outputs-to-inputs/create_some_cheese.sh

  - task: show-some-files
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}

      inputs:
      - name: resource-tutorial
      - name: some-files

      run:
        path: resource-tutorial/tutorials/basic/task-outputs-to-inputs/show_files.sh

  - task: show-some-cheese
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: busybox}

      inputs:
      - name: resource-tutorial
      - name: some-cheese

      run:
        path: resource-tutorial/tutorials/basic/task-outputs-to-inputs/show_cheese.sh

  - task: clean-aws-images
    config:
      platform: linux
      image_resource:
        type: docker-image
        source: {repository: microsoft/powershell}

      inputs:
      - name: resource-tutorial

      run:
        path: pwsh
        args: ['-f', 'resource-tutorial/tutorials/basic/task-outputs-to-inputs/ec2image_clean.ps1']
      params:
        ImageName: {{ImageName}}
        Region: {{Region}}
        AccessKey: {{AccessKey}}
        SecretKey: {{SecretKey}}

  # - task: ec2image_clean
  #   config:
  #     platform: linux
  #     image_resource:
  #       type: docker-image
  #       source: {repository: microsoft/powershell}

  #     inputs:
  #     - name: resource-tutorial
  #     - name: some-cheese

  #     run:
  #       path: pwsh
  #       args: ['-f','resource-tutorial/tutorials/basic/task-outputs-to-inputs/show_cheese.sh', 'sles11']
